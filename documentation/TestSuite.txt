// tests/integration/vadir-sync.test.js
describe('Vadir Data Synchronization', () => {
  test('should sync veteran data with 97% accuracy threshold', async () => {
    const response = await api.post('/api/vadir/sync', {
      veteranId: 'VET-001247'
    });
    
    expect(response.status).toBe(200);
    expect(response.data.accuracy).toBeGreaterThanOrEqual(97);
    expect(response.data.fallbackUsed).toBe(false);
  });

  test('should fallback to DD-214 when Vadir fails', async () => {
    // Mock Vadir API failure
    jest.spyOn(vadirService, 'sync').mockRejectedValue(new Error('API timeout'));
    
    const response = await api.post('/api/vadir/sync', {
      veteranId: 'VET-001247'
    });
    
    expect(response.status).toBe(200);
    expect(response.data.fallbackUsed).toBe(true);
    expect(response.data.source).toBe('DD-214');
  });
});