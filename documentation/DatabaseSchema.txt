-- Core Veterans Table
CREATE TABLE veterans (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    veteran_id VARCHAR(20) UNIQUE NOT NULL,
    ssn_encrypted VARCHAR(255),
    file_number VARCHAR(20),
    full_name VARCHAR(100),
    branch VARCHAR(50),
    service_start DATE,
    service_end DATE,
    discharge_type VARCHAR(50),
    disability_rating INTEGER,
    vadir_accuracy DECIMAL(5,2),
    last_verified TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Vadir Sync History
CREATE TABLE vadir_sync_log (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    veteran_id UUID REFERENCES veterans(id),
    sync_status VARCHAR(20),
    accuracy_score DECIMAL(5,2),
    api_response_time DECIMAL(4,2),
    fallback_used BOOLEAN DEFAULT FALSE,
    error_message TEXT,
    synced_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- API Performance Metrics
CREATE TABLE api_metrics (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    endpoint VARCHAR(100),
    response_time_ms INTEGER,
    status_code INTEGER,
    error_rate DECIMAL(5,2),
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Create indexes for performance
CREATE INDEX idx_veterans_vadir ON veterans(vadir_accuracy);
CREATE INDEX idx_sync_log_time ON vadir_sync_log(synced_at);
CREATE INDEX idx_api_metrics_endpoint ON api_metrics(endpoint, timestamp);